# 业余无线电卡片管理入库系统 - 需求分析与系统设计

## 1. 项目概述

本文档旨在详细分析和设计一个基于Node.js的业余无线电卡片管理入库系统。该系统将帮助业余无线电爱好者管理其QSL卡片（确认联络卡片）收藏，通过二维码标签管理和分类整理功能，提高卡片管理的效率和准确性。

### 1.1 背景介绍

业余无线电爱好者在进行无线电通联后，通常会交换QSL卡片作为确认联络的凭证。随着时间推移，爱好者可能会收集大量卡片，传统的纸质管理方式效率低下且容易出错。因此，一个数字化的卡片管理系统将极大地提高管理效率。

### 1.2 项目目标

设计并实现一个基于Web的业余无线电卡片管理入库系统，具有以下特点：
- 支持卡片信息的录入、查询、修改和删除
- 支持通过二维码进行卡片快速识别和管理
- 提供灵活的卡片分类和标签功能
- 具备良好的用户界面和用户体验
- 系统具有可扩展性，以便未来添加更多功能

## 2. 需求分析

### 2.1 功能需求

#### 2.1.1 用户管理
- 用户注册与登录
- 用户权限管理（管理员和普通用户）
- 用户个人信息管理

#### 2.1.2 卡片管理
- 卡片信息录入（包括呼号、姓名、QTH位置、联络日期、频率、信号报告等）
- 卡片信息查询（支持多条件组合查询）
- 卡片信息修改
- 卡片信息删除（支持批量操作）
- 卡片图片上传和预览

#### 2.1.3 标签识别管理
- 为卡片生成唯一二维码
- 二维码打印功能
- 通过扫描二维码快速查询卡片信息
- 通过扫描二维码快速更新卡片状态
- 支持RFID标签绑定与识别
- RFID标签读写功能
- 通过RFID快速查询和更新卡片信息

#### 2.1.4 分类整理
- 自定义分类创建（如按国家、按频段、按模式等）
- 卡片分类管理（分配、移动、批量操作）
- 分类统计和报表生成

#### 2.1.5 数据导入导出
- 支持从CSV/Excel导入卡片数据
- 支持导出卡片数据为CSV/Excel/PDF
- 支持数据备份和恢复

#### 2.1.6 系统设置
- 系统参数配置
- 日志记录和查询

### 2.2 非功能需求

#### 2.2.1 性能需求
- 系统响应时间：页面加载时间不超过3秒
- 支持同时在线用户数：初期支持50人同时在线
- 数据库性能：支持存储至少10万张卡片信息

#### 2.2.2 安全需求
- 用户密码加密存储
- 数据传输加密
- 防SQL注入和XSS攻击
- 定期数据备份

#### 2.2.3 可用性需求
- 系统7*24小时可用
- 系统界面支持响应式设计，适配PC和移动设备
- 操作界面简洁直观，降低学习成本

#### 2.2.4 可扩展性需求
- 系统架构支持未来功能扩展
- 支持API接口，便于与其他系统集成

## 3. 系统架构设计

### 3.1 总体架构

系统采用前后端分离的架构设计，主要分为以下几层：

1. **表现层**：基于React.js构建的Web前端，提供用户交互界面
2. **应用层**：基于Express.js的RESTful API服务，处理业务逻辑
3. **数据层**：MongoDB数据库，存储系统数据
4. **基础设施层**：Node.js运行环境，提供系统运行基础

### 3.2 技术栈选择

#### 3.2.1 前端技术栈
- **框架**：React.js
- **UI组件库**：Ant Design
- **状态管理**：Redux
- **路由管理**：React Router
- **HTTP客户端**：Axios
- **二维码处理**：qrcode.react（生成）和jsQR（识别）

#### 3.2.2 后端技术栈
- **运行环境**：Node.js
- **Web框架**：Express.js
- **数据库**：MongoDB
- **ORM/ODM**：Mongoose
- **身份认证**：JWT (JSON Web Token)
- **API文档**：Swagger
- **文件上传**：Multer
- **二维码生成**：qrcode
- **RFID通信**：node-serialport, rfid-nodejs

#### 3.2.3 开发工具与环境
- **版本控制**：Git
- **包管理**：npm/yarn
- **代码质量**：ESLint
- **测试工具**：Jest, Supertest
- **CI/CD**：GitHub Actions

### 3.3 系统模块设计

系统主要分为以下几个模块：

1. **用户模块**：负责用户注册、登录、权限管理等功能
2. **卡片管理模块**：负责卡片的CRUD操作
3. **标签识别模块**：负责二维码和RFID的生成、识别等功能
4. **分类模块**：负责卡片分类的管理
5. **导入导出模块**：负责数据的导入导出
6. **系统设置模块**：负责系统参数配置和日志管理

### 3.4 数据流程

1. 用户通过前端界面发起请求
2. 请求经过身份验证和权限检查
3. 后端处理业务逻辑并操作数据库
4. 返回处理结果给前端
5. 前端展示结果给用户

### 3.5 安全设计

1. **身份认证**：采用JWT进行身份验证
2. **权限控制**：基于角色的访问控制（RBAC）
3. **数据加密**：敏感数据加密存储
4. **输入验证**：前后端双重验证，防止恶意输入
5. **HTTPS**：使用HTTPS协议保障传输安全

## 4. 数据库设计（初步）

### 4.1 实体关系

主要实体包括：
- 用户（User）
- 卡片（Card）
- 分类（Category）
- 标签（Tag）
- 日志（Log）

实体间关系：
- 一个用户可以拥有多张卡片
- 一张卡片可以属于多个分类
- 一张卡片可以有多个标签
- 系统操作产生多条日志记录

### 4.2 数据模型（概要）

以下是主要数据模型的概要设计，详细字段将在数据库设计阶段完善：

#### 用户模型（User）
- id: 唯一标识
- username: 用户名
- password: 密码（加密存储）
- email: 电子邮箱
- role: 角色（admin/user）
- createdAt: 创建时间
- updatedAt: 更新时间

#### 卡片模型（Card）
- id: 唯一标识
- userId: 所属用户ID
- callsign: 呼号
- name: 姓名
- qth: 位置
- date: 联络日期
- frequency: 频率
- mode: 模式
- rst: 信号报告
- qslStatus: QSL状态
- imageUrl: 卡片图片URL
- qrCode: 二维码数据
- rfidTag: RFID标签ID
- rfidStatus: RFID标签状态
- categories: 所属分类ID数组
- tags: 标签ID数组
- notes: 备注
- createdAt: 创建时间
- updatedAt: 更新时间

#### 分类模型（Category）
- id: 唯一标识
- userId: 所属用户ID
- name: 分类名称
- description: 分类描述
- parentId: 父分类ID（支持层级分类）
- createdAt: 创建时间
- updatedAt: 更新时间

#### 标签模型（Tag）
- id: 唯一标识
- userId: 所属用户ID
- name: 标签名称
- color: 标签颜色
- createdAt: 创建时间
- updatedAt: 更新时间

#### 日志模型（Log）
- id: 唯一标识
- userId: 操作用户ID
- action: 操作类型
- target: 操作对象
- detail: 操作详情
- ip: 操作IP
- createdAt: 创建时间

## 5. 接口设计（初步）

系统将提供RESTful API，主要接口包括：

### 5.1 用户接口
- POST /api/auth/register - 用户注册
- POST /api/auth/login - 用户登录
- GET /api/users/profile - 获取用户信息
- PUT /api/users/profile - 更新用户信息
- PUT /api/users/password - 修改密码

### 5.2 卡片接口
- POST /api/cards - 创建卡片
- GET /api/cards - 获取卡片列表（支持分页和筛选）
- GET /api/cards/:id - 获取单个卡片详情
- PUT /api/cards/:id - 更新卡片信息
- DELETE /api/cards/:id - 删除卡片
- POST /api/cards/batch - 批量操作卡片

### 5.3 标签识别接口
- POST /api/tags/qrcode/generate - 生成二维码
- POST /api/tags/qrcode/scan - 扫描识别二维码
- GET /api/tags/qrcode/:cardId - 获取卡片二维码
- POST /api/tags/rfid/bind - 绑定RFID标签
- POST /api/tags/rfid/read - 读取RFID标签
- POST /api/tags/rfid/write - 写入RFID标签
- GET /api/tags/rfid/:cardId - 获取卡片RFID信息
- PUT /api/tags/rfid/:cardId - 更新卡片RFID信息

### 5.4 分类接口
- POST /api/categories - 创建分类
- GET /api/categories - 获取分类列表
- GET /api/categories/:id - 获取分类详情
- PUT /api/categories/:id - 更新分类
- DELETE /api/categories/:id - 删除分类
- GET /api/categories/:id/cards - 获取分类下的卡片

### 5.5 标签接口
- POST /api/tags - 创建标签
- GET /api/tags - 获取标签列表
- PUT /api/tags/:id - 更新标签
- DELETE /api/tags/:id - 删除标签
- GET /api/tags/:id/cards - 获取标签下的卡片

### 5.6 导入导出接口
- POST /api/import/csv - 导入CSV数据
- POST /api/import/excel - 导入Excel数据
- GET /api/export/csv - 导出CSV数据
- GET /api/export/excel - 导出Excel数据
- GET /api/export/pdf - 导出PDF数据

### 5.7 系统接口
- GET /api/system/logs - 获取系统日志
- GET /api/system/settings - 获取系统设置
- PUT /api/system/settings - 更新系统设置

## 6. 用户界面设计（概要）

系统界面将采用响应式设计，主要包括以下页面：

### 6.1 公共页面
- 登录页面
- 注册页面
- 忘记密码页面

### 6.2 用户页面
- 仪表盘/首页
- 卡片管理页面
- 卡片详情页面
- 二维码管理页面
- RFID标签管理页面
- 分类管理页面
- 标签管理页面
- 导入导出页面
- 个人设置页面

### 6.3 管理员页面
- 用户管理页面
- 系统设置页面
- 日志查询页面

## 7. 实施计划

项目将分为以下几个阶段实施：

### 7.1 准备阶段
- 需求分析与确认
- 系统设计
- 开发环境搭建

### 7.2 开发阶段
- 数据库设计与实现
- 后端API开发
- 前端界面开发
- 二维码功能实现
- RFID功能实现

### 7.3 测试阶段
- 单元测试
- 集成测试
- 用户验收测试

### 7.4 部署阶段
- 系统部署
- 用户培训
- 系统上线

## 8. 风险评估与应对策略

### 8.1 潜在风险
- 需求变更频繁
- 技术实现难度超出预期
- 性能问题
- 安全漏洞
- 用户接受度低

### 8.2 应对策略
- 采用敏捷开发方法，增量式交付
- 技术预研和原型验证
- 性能测试和优化
- 安全审计和渗透测试
- 用户参与设计过程，提高接受度

## 9. 结论

本文档详细分析了业余无线电卡片管理入库系统的需求，并提出了系统设计方案。该系统将基于Node.js构建，采用前后端分离架构，实现卡片管理、二维码标签管理和分类整理等核心功能。

系统设计注重可扩展性和用户体验，为后续功能扩展提供了良好的基础。通过该系统，业余无线电爱好者将能够更高效地管理其QSL卡片收藏。

## 10. 附录

### 10.1 术语表
- **QSL卡片**：确认联络卡片，业余无线电爱好者用来确认通联的纸质卡片
- **呼号**：业余无线电台的识别代码
- **QTH**：电台所在地理位置
- **RST**：信号报告，包括可辨度(R)、强度(S)和音调(T)

