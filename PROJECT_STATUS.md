# 个人QSL卡管理平台

## 项目概述

个人QSL卡管理平台是一个专为业余无线电爱好者设计的个人QSL卡片管理系统，支持卡片的数字化管理、二维码标签识别、RFID/NFC读取等功能。系统采用前后端分离架构，特别优化了移动端和安卓PDA设备的使用体验。

**重要变更**: 项目已从多用户系统调整为个人管理平台，支持单用户多呼号档案管理。

## 核心需求

### 1. 基础功能需求

#### 1.1 系统初始化
- ✅ 首次使用时系统初始化设置
- ✅ 用户自定义账号和密码
- ✅ 个人信息配置（姓名、呼号、QTH等）
- ❌ ~~多用户注册功能~~ (已移除)

#### 1.2 用户认证
- ✅ 单用户登录系统
- ✅ 密码修改功能
- ✅ JWT令牌认证机制
- ❌ ~~用户注册、密码重置~~ (已移除)

#### 1.3 卡片管理
- ✅ QSL卡片信息录入和编辑
- ✅ **已完成**: 卡片编号自动生成系统
  - 格式：年份（两位）+序号（递增）+类型（RC/TC）+随机16位16进制编码
  - 示例：25000001RCb7e3c867f378a25a
  - 登记入库时自动分配编码
  - 收卡(RC)和发卡(TC)分别计数
- ✅ 卡片分类和标签管理
- ✅ 收到卡片(RC)和发出卡片(TC)分别管理
- ✅ 卡片搜索和筛选功能
- ✅ 批量导入导出功能

#### 1.4 多呼号档案管理
- ✅ **已修复**: 呼号档案添加功能
- ✅ 支持管理多个呼号档案
- ✅ 默认呼号设置
- ✅ 呼号档案与卡片关联
- ✅ 按呼号筛选卡片数据

#### 1.5 标签识别系统
- ✅ 二维码扫描功能（支持摄像头扫描）
- ✅ RFID标签读取功能
- ✅ NFC芯片识别功能
- ✅ 手动输入标签信息
- ✅ 扫描历史记录管理

### 2. 高级功能需求

#### 2.1 EYEBALL卡管理
- ✅ EYEBALL活动卡片专门管理
- ✅ 活动信息关联和统计
- ✅ 特殊标识和分类

#### 2.2 证书管理
- ✅ 证书模板管理
- ✅ 证书生成和打印
- ✅ 证书关联卡片记录

#### 2.3 RFID设备管理
- ✅ RFID读写设备配置
- ✅ 设备状态监控
- ✅ 读取日志记录

### 3. 技术需求

#### 3.1 跨平台支持
- ✅ Web浏览器访问
- ✅ 移动端响应式设计
- ✅ 安卓PDA设备优化
- ✅ 扫码和NFC功能集成

#### 3.2 数据管理
- ✅ 数据备份和恢复
- ✅ 数据导入导出
- ✅ 数据统计和报表

## 技术架构

### 后端技术栈
- **运行环境**: Node.js 22.13.0
- **Web框架**: Express.js
- **数据库**: MongoDB + Mongoose
- **认证**: JWT (JSON Web Token)
- **文件上传**: Multer
- **PDF生成**: Puppeteer + Handlebars
- **二维码**: QRCode
- **日期处理**: Moment.js
- **分页**: mongoose-paginate-v2

### 前端技术栈
- **框架**: React 18 + Vite
- **UI组件**: Tailwind CSS + shadcn/ui
- **图标**: Lucide React
- **路由**: React Router DOM
- **状态管理**: React Context API
- **HTTP客户端**: Axios
- **图表**: Recharts

### 数据库设计
- **用户模型**: 简化的单用户信息管理
- **呼号档案模型**: 多呼号档案管理
- **卡片模型**: QSL卡片信息（含自动编号）
- **卡片计数器模型**: 编号生成计数器
- **分类模型**: 卡片分类管理
- **标签模型**: 卡片标签系统
- **发卡模型**: 发出卡片记录
- **EYEBALL模型**: EYEBALL活动卡片
- **证书模型**: 证书和模板管理
- **RFID设备模型**: 设备配置和日志

## 项目进度

### ✅ 已完成功能

#### 后端开发 (95%)
1. **基础架构**
   - ✅ Express.js服务器搭建
   - ✅ MongoDB数据库连接
   - ✅ JWT认证中间件
   - ✅ 错误处理机制
   - ✅ 文件上传中间件

2. **用户系统重构**
   - ✅ 移除多用户功能
   - ✅ 实现系统初始化功能
   - ✅ 简化用户模型
   - ✅ 单用户认证系统

3. **卡片编号系统**
   - ✅ 卡片计数器模型
   - ✅ 自动编号生成算法
   - ✅ 年份+序号+类型+随机码格式
   - ✅ 收卡(RC)和发卡(TC)分别计数

4. **呼号档案系统**
   - ✅ 呼号档案模型（单用户模式）
   - ✅ 多呼号管理功能
   - ✅ 默认呼号设置
   - ✅ 呼号档案添加功能修复完成

5. **API接口**
   - ✅ 系统初始化API
   - ✅ 用户认证API（登录、密码修改）
   - ✅ 呼号档案管理API
   - ✅ 卡片管理API（含自动编号）
   - ✅ 分类和标签API
   - ✅ 二维码生成API
   - ✅ RFID设备管理API

#### 前端开发 (60%)
1. **基础架构**
   - ✅ React + Vite项目搭建
   - ✅ Tailwind CSS样式系统
   - ✅ 路由配置和导航
   - ✅ 认证上下文管理
   - ✅ API服务封装

2. **用户界面（需要调整）**
   - 🚧 系统初始化页面（需要开发）
   - ✅ 登录页面
   - ❌ ~~注册页面~~ (需要移除)
   - ✅ 响应式主布局和侧边栏
   - ✅ 仪表盘页面
   - ✅ 卡片管理页面（收到/发出）
   - ✅ 呼号档案管理页面
   - ✅ 二维码扫描页面
   - ✅ RFID/NFC读取页面

3. **功能特性**
   - ✅ 摄像头二维码扫描
   - ✅ Web NFC API集成
   - ✅ 手动输入标签信息
   - ✅ 扫描历史记录
   - ✅ 移动端优化
   - ✅ PDA设备适配

#### 部署和运维 (80%)
1. **版本控制**
   - ✅ GitHub仓库管理
   - ✅ SSH密钥配置
   - ✅ 自动提交脚本

2. **开发环境**
   - ✅ 本地开发服务器
   - ✅ 热重载配置
   - ✅ 调试工具集成

### 🚧 进行中功能

#### 前端调整 (进行中)
1. **移除多用户相关UI**
   - 🚧 移除注册页面和相关组件
   - 🚧 调整导航菜单
   - 🚧 简化用户管理界面

2. **呼号档案管理UI调整**
   - 🚧 优化呼号档案管理界面
   - 🚧 优化用户体验
   - 🚧 添加卡片编号显示功能

### 📋 待完成功能

#### 前端完善 (40%)
1. **系统初始化界面**
   - 📋 首次使用引导页面
   - 📋 账号密码设置界面
   - 📋 个人信息配置表单

2. **页面调整**
   - 📋 移除多用户相关页面
   - 📋 调整用户设置页面
   - 📋 优化呼号档案管理界面

3. **功能增强**
   - 📋 卡片编号显示和搜索
   - 📋 高级搜索和筛选
   - 📋 数据可视化图表
   - 📋 批量操作功能

#### 系统优化
1. **性能优化**
   - 📋 数据库查询优化
   - 📋 前端代码分割
   - 📋 图片懒加载
   - 📋 缓存策略

2. **安全加固**
   - 📋 输入验证增强
   - 📋 XSS防护
   - 📋 CSRF保护
   - 📋 访问频率限制

3. **用户体验**
   - 📋 加载状态提示
   - 📋 错误处理优化
   - 📋 操作反馈改进
   - 📋 帮助文档

## 最新需求变更 - 2025年6月10日

### 🔄 重大调整

#### 1. 系统架构调整
- **从多用户系统改为个人管理平台**
  - 移除用户注册、邮箱验证等多用户功能
  - 实现首次使用时的系统初始化
  - 用户自定义账号和密码
  - 简化数据库架构，所有数据存储在单一数据库

#### 2. 卡片编号系统
- **新的编号格式要求**
  - 格式：年份（两位）+序号（6位递增）+类型（RC/TC）+随机16位16进制编码
  - 示例：250001RCa1b2c3d4e5f6a7b8
  - 编码中不包含加号或其他分隔符
  - QSL卡登记入库出库时即分配编码
  - 收卡(RC)和发卡(TC)分别计数

#### 3. 多呼号档案支持
- **个人多呼号管理**
  - 支持一个用户管理多个呼号档案
  - 可设置默认呼号
  - 卡片数据与呼号档案关联
  - 按呼号筛选和管理卡片

### ✅ 已解决的问题
1. **呼号档案添加功能异常** - 已修复
   - ✅ API接口调试完成
   - ✅ 数据验证问题解决
   - ✅ 错误处理优化完成

### 📊 当前完成度
- **后端开发**: 95% (主要功能已完成)
- **前端开发**: 60% (需要移除多用户UI，调整呼号档案界面)
- **数据库设计**: 100% (已实现新的编号系统)
- **用户认证**: 95% (已简化为单用户模式)
- **卡片编号**: 100% (已实现并测试通过新格式)
- **多呼号管理**: 95% (添加功能已修复完成)

## 部署架构

### 开发环境
- **后端**: http://localhost:5000
- **前端**: http://localhost:5173
- **数据库**: MongoDB本地实例

### 生产环境
- **前端**: https://rrdycqij.manus.space
- **后端**: 本地运行在端口5000
- **数据库**: MongoDB本地实例

## 文件结构

```
radio-card-system/
├── src/                          # 后端源码
│   ├── controllers/              # 控制器
│   │   ├── auth.controller.js    # 认证控制器（已简化）
│   │   ├── callsignProfile.controller.js # 呼号档案控制器
│   │   └── ...
│   ├── models/                   # 数据模型
│   │   ├── user.model.js         # 用户模型（已简化）
│   │   ├── callsignProfile.model.js # 呼号档案模型
│   │   ├── card.model.js         # 卡片模型（含编号系统）
│   │   └── ...
│   ├── routes/                   # 路由定义
│   ├── middleware/               # 中间件
│   ├── utils/                    # 工具函数
│   └── app.js                    # 应用入口（已简化）
├── frontend/radio-card-frontend/ # 前端源码
│   ├── src/
│   │   ├── components/           # React组件
│   │   ├── pages/                # 页面组件
│   │   ├── layouts/              # 布局组件
│   │   ├── contexts/             # 上下文
│   │   ├── services/             # API服务
│   │   └── routes.jsx            # 路由配置
│   ├── public/                   # 静态资源
│   └── package.json              # 前端依赖
├── uploads/                      # 上传文件
├── docs/                         # 文档目录
├── package.json                  # 后端依赖
├── .env                          # 环境变量
├── .gitignore                    # Git忽略文件
├── README.md                     # 项目说明
├── LICENSE                       # 开源协议
└── auto_commit.sh                # 自动提交脚本
```

## 开发团队

- **项目负责人**: BH2VSQ
- **开发者**: Manus AI Assistant
- **技术栈**: Node.js + React + MongoDB

## 联系信息

- **GitHub**: https://github.com/BH2VSQ/radio-card-system
- **邮箱**: mhskp@foxmail.com

## 开源协议

本项目采用 MIT 开源协议，详见 [LICENSE](LICENSE) 文件。

---

*最后更新时间: 2025年6月10日*
*项目版本: v2.0.0-beta (个人管理平台版本)*

### 部署日志

- **2025年6月10日 - 系统架构重构**
  - 将多用户系统调整为个人QSL卡管理平台
  - 实现新的卡片编号生成系统
  - 简化用户认证和数据库架构
  - 修复呼号档案管理功能
  - 移除多用户相关功能和界面
  - 优化单用户体验

- **2025年6月10日 - 后端重构完成**
  - ✅ 用户模型简化
  - ✅ 呼号档案模型调整
  - ✅ 卡片编号系统实现并测试通过
  - ✅ 认证系统重构
  - ✅ API接口调整
  - ✅ 呼号档案添加功能修复完成

- **2025年6月10日 - 功能验证完成**
  - ✅ 系统初始化API测试通过
  - ✅ 呼号档案创建API测试通过
  - ✅ 卡片编号生成测试通过（收卡RC: 25000001RCb7e3c867f378a25a）
  - ✅ 卡片编号生成测试通过（发卡TC: 25000001TCde064059e48782bd）
  - ✅ 后端核心功能验证完成

- **2025年6月10日 - 前端调整进行中**
  - 🚧 移除多用户相关UI
  - 🚧 呼号档案管理界面调整
  - 📋 系统初始化界面开发
  - 📋 用户体验优化

---

*项目持续更新中，后端核心功能已完成，当前专注于前端界面调整和用户体验优化。*

